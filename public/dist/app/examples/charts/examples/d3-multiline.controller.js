(function() {
    'use strict';

    angular
        .module('app.examples.charts')
        .controller('D3MultiLineChartController', D3MultiLineChartController);

    /* @ngInject */
    function D3MultiLineChartController() {
        var vm = this;

        vm.multiLineChartOptions = {
            chart: {
                type: 'multiChart',
                height: 450,
                margin : {
                    top: 30,
                    right: 60,
                    bottom: 50,
                    left: 70
                },
                color: d3.scale.category10().range(),
                //useInteractiveGuideline: true,
                duration: 500,
                xAxis: {
                    tickFormat: function(d){
                        return d3.format(',f')(d);
                    }
                },
                yAxis1: {
                    tickFormat: function(d){
                        return d3.format(',.1f')(d);
                    }
                },
                yAxis2: {
                    tickFormat: function(d){
                        return d3.format(',.1f')(d);
                    }
                }
            }
        };

        vm.multiLineChartData = generateMultiLineData();

        function generateMultiLineData(){
            var testdata = stream_layers(7,10+Math.random()*100,.1).map(function(data, i) {
                return {
                    key: 'AWS ' + i,
                    values: data.map(function(a){a.y = a.y * (i <= 1 ? -1 : 1); return a;})
                };
            });

            testdata[0].type = 'area';
            testdata[0].yAxis = 1;
            testdata[1].type = 'area';
            testdata[1].yAxis = 1;
            testdata[2].type = 'line';
            testdata[2].yAxis = 1;
            testdata[3].type = 'line';
            testdata[3].yAxis = 2;
            testdata[4].type = 'bar';
            testdata[4].yAxis = 2;
            testdata[5].type = 'bar';
            testdata[5].yAxis = 2;
            testdata[6].type = 'bar';
            testdata[6].yAxis = 2;

            return testdata;
        }

        /* Inspired by Lee Byron's test data generator. */
        function stream_layers(n, m, o) {
            if (arguments.length < 3) o = 0;
            function bump(a) {
                var x = 1 / (.1 + Math.random()),
                    y = 2 * Math.random() - .5,
                    z = 10 / (.1 + Math.random());
                for (var i = 0; i < m; i++) {
                    var w = (i / m - y) * z;
                    a[i] += x * Math.exp(-w * w);
                }
            }
            return d3.range(n).map(function() {
                var a = [], i;
                for (i = 0; i < m; i++) a[i] = o + o * Math.random();
                for (i = 0; i < 5; i++) bump(a);
                return a.map(stream_index);
            });
        }

        function stream_index(d, i) {
            return {x: i, y: Math.max(0, d)};
        }
    }
})();